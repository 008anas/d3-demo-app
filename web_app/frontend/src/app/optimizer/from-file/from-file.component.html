<div class="ui fluid container">

  <div class="ui vertical masthead center aligned">

    <div class="ui text container">
      <h1 class="ui header">Upload your GenBank</h1>
      <h2 class="ui header">Allowed extensions: .gb .gbk .genbank.</h2>

      <div class="field" *ngIf="response">
        <sqy-errors-list [errors]="response"></sqy-errors-list>
      </div>
      <form class="ui form" [formGroup]="form" (ngSubmit)="onSubmit()">

        <div class="required seven wide field">
          <label>Organism</label>
          <select class="ui dropdown" name="construct-specie" id="construct_specie" required [(ngModel)]="specie.tax_id">
            <option *ngFor="let s of species" [ngValue]="s.tax_id">{{s.name}}</option>
          </select>
        </div>

        <div class="field">
          <sqy-file-uploader></sqy-file-uploader>
        </div>
      </form>

      <div class="ui basic segment" *ngIf="isUploading && !construct">
        <div class="ui active inverted dimmer">
          <div class="ui text loader">Gutting file...</div>
        </div>
      </div>

      <div class="ui grid" *ngIf="construct && !isUploading">

        <div class="row">

          <div class="sixteen wide column">

            <div class="ui two item secondary pointing menu">
              <a class="item" (click)="view = 'general'" [ngClass]="{'active': view === 'general'}">
                General
              </a>
              <a class="item" (click)="view = 'tracks'" [ngClass]="{'active': view === 'tracks'}">
                Tracks
              </a>
            </div>
          </div>

        </div>

        <div class="row">

          <div class="sixteen wide column" style="height: 80vh; overflow: auto">

            <form class="ui form" #constructForm="ngForm" (ngSubmit)="submit()" *ngIf="view === 'general'">

              <div class="required field">
                <label class="required-msg">Required fields are shown with</label>
              </div>

              <div class="required field">
                <label for="construct_specie">Select organism</label>
                <select class="ui dropdown" name="construct-specie" id="construct_specie" required [(ngModel)]="specie.tax_id">
                  <option *ngFor="let s of species" [ngValue]="s.tax_id">{{s.name}}</option>
                </select>
              </div>

              <div class="required field" [ngClass]="{'error': name.invalid && (name.dirty || name.touched)}">
                <label for="construct_name">Enter a label</label>
                <input type="text" class="transparent" placeholder="Label / Name" id="construct_name" name="construct-name" #name="ngModel" required [(ngModel)]="construct.name">
              </div>

              <div class="inline field">
                <label for="">Circular</label>
                <input type="checkbox" [(ngModel)]="construct.circular" name="construct-circular">
              </div>

              <div class="inline field">
                <label for="construct_description">Description</label>
                <textarea [(ngModel)]="construct.description" id="construct_description" name="construct-description" rows="8" cols="80"></textarea>
              </div>

              <div class="field">
                <button class="ui secondary right labeled fluid icon button" [disabled]="!construct.tracks?.length || constructForm.invalid" type="submit">
                  Submit
                  <i class="angle right icon"></i>
                </button>
              </div>

            </form>

            <div class="ui one column grid" *ngIf="view === 'tracks'">

              <div class="column">
                <div class="ui fluid icon input">
                  <i class="search icon"></i>
                  <input type="text" placeholder="Search by label / type / sequence..." [(ngModel)]="search">
                </div>
              </div>

              <div class="column">
                <table class="ui blue definition table">

                  <thead>
                    <tr>
                      <th></th>
                      <th>
                        Label
                      </th>
                      <th>
                        Type
                      </th>
                      <th>
                        Size
                      </th>
                      <th></th>
                    </tr>
                  </thead>

                  <tbody>

                    <tr *ngIf="!construct.tracks?.length">
                      <td class="txt-c" colspan="5">The construct is empty. Add new tracks to visualize them here.</td>
                    </tr>

                    <tr *ngFor="let tr of construct.tracks | filterTracks: search; let in = index">
                      <td>
                        <div class="ui circular label" [ngClass]="{'no-color': !tr.color}" [style.background-color]="tr.color">#{{in+1}}</div>
                      </td>
                      <td>
                        <sqy-if-not-icon [value]="tr.label"></sqy-if-not-icon>
                      </td>
                      <td>
                        <sqy-if-not-icon [value]="tr.type"></sqy-if-not-icon>
                      </td>
                      <td>
                        <sqy-if-not-icon [value]="tr.sequence?.length"></sqy-if-not-icon>
                      </td>
                      <td class="center aligned">
                        <a data-inverted="" data-tooltip="Open" data-position="top center" [ngClass]="{'disabled': locked}" (click)="openSidebar(tr, in)">
                          <i class="edit icon"></i>
                        </a>
                        <a data-inverted="" data-tooltip="Move up" data-position="top center" [ngClass]="{'disabled': locked || in < 1}" (click)="moveTrack(in, -1)">
                          <i class="arrow up icon"></i>
                        </a>
                        <a data-inverted="" data-tooltip="Move down" data-position="top center" [ngClass]="{'disabled': locked || in >= construct.tracks?.length-1}" (click)="moveTrack(in, +1)">
                          <i class="arrow down icon"></i>
                        </a>
                        <a data-inverted="" data-tooltip="Delete" data-position="top center" [ngClass]="{'disabled': locked}" (click)="removeTrack(tr)">
                          <i class="x red icon"></i>
                        </a>
                      </td>
                    </tr>

                  </tbody>

                </table>

              </div>

            </div>

          </div>

        </div>

      </div>

      <!-- <form class="ui form" #constructForm="ngForm" (ngSubmit)="submit()" *ngIf="construct">

        <div class="field">
          <div class="ui two item secondary pointing menu">
            <a class="item" (click)="view = 'general'" [ngClass]="{'active': view === 'general'}">
              General
            </a>
            <a class="item" (click)="view = 'tracks'" [ngClass]="{'active': view === 'tracks'}">
              Tracks
            </a>
          </div>
        </div>

        <div class="required field">
          <label class="required-msg">Required fields are shown with</label>
        </div>

        <div class="required field" [ngClass]="{'error': name.invalid && (name.dirty || name.touched)}">
          <label for="construct_name">Enter a label</label>
          <input type="text" class="transparent" placeholder="Label / Name" id="construct_name" name="construct-name" #name="ngModel" required [(ngModel)]="construct.name">
        </div>

        <div class="inline required field">
          <label for="">Circular</label>
          <input type="checkbox" [(ngModel)]="construct.circular" name="construct-circular">
        </div>

        <div class="inline field">
          <label for="construct_description">Description</label>
          <textarea [(ngModel)]="construct.description" id="construct_description" name="construct-description" rows="8" cols="80"></textarea>
        </div>

        <div class="inline required field">
          <label for="construct_dna_seq">Sequence</label>
          <textarea [(ngModel)]="construct.dna_seq" id="construct_dna_seq" name="construct-dna-seq" rows="8" cols="80"></textarea>
        </div>

        <div class="field">
          <button class="ui secondary right labeled fluid icon button" [disabled]="!construct.tracks?.length || constructForm.invalid" type="submit">
            Submit
            <i class="angle right icon"></i>
          </button>
        </div>

      </form> -->

    </div>


  </div>

</div>
